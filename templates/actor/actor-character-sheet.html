<form class="{{cssClass}} {{actor.type}} backgroundstyle fabulaultima-actor-sheet" autocomplete="off">

  <!-- Start Sheet Header -->
  <header class="sheet-header">
    <img class="profile-img" src="{{actor.img}}" data-edit="img" data-tooltip="{{actor.name}}" />
    <div class="header-fields">
      <div class="grid grid-6col">
        <h1 class="charname grid-span-4 flex-between">
          <input name="name" type="text" value="{{actor.name}}" placeholder="Name" class="resource-input-charname auto-shrink" />
        </h1>

        <!-- Level -->
        <span class="levelup">
          <label class="resource-label-sm" for="system.level.value">
            <i class="fa-solid fa-chart-simple icon"></i>{{localize 'FU.LevelAbbr'}}
          </label>
          <input type="text" name="system.level.value" value="{{system.level.value}}" data-dtype="Number" class="resource-input" />
        </span>

        <!-- Experience -->
        <span class="levelup">
          <label class="resource-label-sm" for="system.resources.exp.value">
            <i class="fa-solid fa-feather-pointed"></i>{{localize 'FU.ExpAbbr'}} <i class="fas fa-level-up"></i>
          </label>
          <input type="text" name="system.resources.exp.value" value="{{system.resources.exp.value}}" data-dtype="Number" class="resource-input" />
        </span>
      </div>

      <!-- Point Bars -->
      <div class="grid grid-3col">

        <!-- HP -->
        <div class="resource flex-group-center align-left">
          <label for="system.resources.hp.value" class="resource-label" data-tooltip="Hit Points" aria-describedby="tooltip">
            <span class="resource-label">
              <i class="fa-solid fa-heart icon"></i>{{localize 'FU.HealthAbbr'}}
            </span>
          </label>
          <div class="bar bar-progress">
            <div class="bar-progress-bar bar-hp" style="width: 100%;"></div>
            <span class="bar-value"></span>
          </div>
          <div class="resource-content flexrow flex-center flex-between align-center">
            <input class="resource-current-input bar-start" type="text" name="system.resources.hp.value" value="{{system.resources.hp.value}}" data-dtype="Number" />
            <span class="resource-middle-input bar-middle" data-tooltip="{{localize 'FU.HealthAbbr'}}<br>Current: {{system.resources.hp.value}}<br>Crisis: {{half system.resources.hp.max}}
              <br>Mod: {{system.resources.hp.bonus}} <br>Max: {{system.resources.hp.max}}" aria-describedby="tooltip">
              <i class="fa-solid fa-caret-up"></i>
            </span>
            <input class="resource-max-input bar-end" type="text" name="system.resources.hp.max" value="{{system.resources.hp.max}}" data-dtype="Number" disabled="{{system.resources.hp.max}}" />
          </div>
        </div>

        <!-- MP -->
        <div class="resource flex-group-center align-left">
          <label for="system.resources.mp.value" class="resource-label" data-tooltip="Mind Points" aria-describedby="tooltip">
            <span class="resource-label">
              <i class="fa-solid fa-wand-magic-sparkles icon"></i>{{localize 'FU.MindAbbr'}}
            </span>
          </label>
          <div class="bar bar-progress">
            <div class="bar-progress-bar bar-mp" style="width: 100%;"></div>
            <span class="bar-value"></span>
          </div>
          <div class="resource-content flexrow flex-center flex-between align-center">
            <input class="resource-current-input bar-start" type="text" name="system.resources.mp.value" value="{{system.resources.mp.value}}" data-dtype="Number" class="resource-input bar-start" />
            <span class="resource-middle-input bar-middle" data-tooltip="{{localize 'FU.MindPoints'}}<br>Current: {{system.resources.mp.value}}<br>Mod: {{system.resources.mp.bonus}} <br>Max: {{system.resources.mp.max}}" aria-describedby="tooltip">
              <i class="fa-solid fa-caret-up"></i>
            </span>
            <input class="resource-max-input bar-end" type="text" name="system.resources.mp.max" value="{{system.resources.mp.max}}" data-dtype="Number" disabled="{{system.resources.mp.max}}" />
          </div>
        </div>

        <!-- IP -->
        <div class="resource flex-group-center align-left">
          <label for="system.resources.ip.value" class="resource-label align-left" data-tooltip="Inventory Points" aria-describedby="tooltip">
            <span class="resource-label">
              <i class="fa-solid fa-backpack icon"></i>{{localize 'FU.InventoryAbbr'}}
            </span>
          </label>
          <div class="bar bar-progress">
            <div class="bar-progress-bar bar-ip" style="width: 100%;"></div>
            <span class="bar-value"></span>
          </div>
          <div class="resource-content flexrow flex-center flex-between align-center">
            <input class="resource-current-input bar-start" type="text" name="system.resources.ip.value" value="{{system.resources.ip.value}}" data-dtype="Number"/>
            <span class="resource-middle-input bar-middle" data-tooltip="{{localize 'FU.InventoryPoints'}}<br>Current: {{system.resources.ip.value}}<br>Mod: X <br>Max: {{system.resources.ip.max}}" aria-describedby="tooltip" >  
              <i class="fa-solid fa-caret-up"></i>
            </span>
            <input class="resource-max-input bar-end" type="text" name="system.resources.ip.max" value="{{system.resources.ip.max}}" data-dtype="Number" disabled="{{system.resources.ip.max}}" />
          </div>
        </div>

      </div>
    </div>
  </header>
  <!-- End Sheet Header -->

  <!-- Start Extra Section -->
  <div class="grid grid-4col" style="align-items: baseline;">

    <!-- Fabula Points -->
    <div class="resource-content  flex-group-center">
      <label for="system.resources.fp.value">
        <span class="resource-label">
          <i class="fa-solid fa-crystal-ball icon"></i>{{localize 'FU.FabulaPoints'}}
        </span>
      </label>
      <div class="buttons-inc">
        <button class="decrement-button" data-resource="fp" data-action="decrease"><i class="fas fa-minus"></i></button>
        <input type="text" name="system.resources.fp.value" value="{{system.resources.fp.value}}" data-dtype="Number" id="fp-input" class="fp-resource-input" />
        <button class="increment-button" data-resource="fp" data-action="increase"><i class="fas fa-plus"></i></button>
      </div>
    </div>

    <!-- DEF -->
    <div class="resource-content  flex-group-center">
      <label for="system.derived.def.value" class="resource-label rollable" data-label="{{localize 'FU.Defense'}}" data-type="def"></label>
        <span class="rollable resource-label">
          <i class="fa-solid fa-shield icon"></i>{{localize 'FU.DefenseAbbr'}}
        </span>
      </label>
      <div class="resource-content  flex-center">
        <input class="resource-input" id="def-input"type="text" name="system.derived.def.value" value="{{system.derived.def.value}}" data-dtype="Number" data-tooltip="{{localize 'FU.Defense'}}<br>Current: {{system.derived.def.value}}<br>Mod: {{system.derived.def.bonus}}" aria-describedby="tooltip" disabled>
      </div>
    </div>

    <!-- MDEF -->
    <div class="resource-content  flex-group-center">
      <label for="system.derived.mdef.value" class="resource-label rollable" data-label="{{localize 'FU.MagicDefense'}}" data-type="mdef"></label>
        <span class="rollable resource-label">
          <i class="fa-solid fa-shield-halved icon"></i>{{localize 'FU.MagicDefenseAbbr'}}
        </span>
      </label>
      <div class="resource-content  flex-center">
        <input class="resource-input" id="mdef-input" type="text" name="system.derived.mdef.value" value="{{system.derived.mdef.value}}" data-dtype="Number" data-tooltip="{{localize 'FU.MagicDefense'}}<br>Current: {{system.derived.mdef.value}}<br>Mod: {{system.derived.mdef.bonus}}" aria-describedby="tooltip" disabled>
      </div>
    </div>

    <!-- Initiative -->
    <div class="resource-content  flex-group-center">
      <div class="resource-label" data-label="Initiative">
        <span class="rollable resource-label rollinit" data-type="rollinit" data-roll-type="rollinit" data-roll="1d@attributes.dex.current + 1d@attributes.ins.current + @derived.init.value">
          <i class="fa-solid fa-clock icon"></i>{{localize 'FU.IsInitiative'}}
        </span>
      </div>
      <div class="resource-content flex-center">
        <input class="resource-input" id="init-input" type="text" name="system.derived.init.value" value="{{system.derived.init.value}}" data-dtype="Number" data-tooltip="{{localize 'FU.Initiative'}}<br>Current: {{system.derived.init.value}}<br>Bonus: {{system.derived.init.bonus}}" aria-describedby="tooltip"  disabled>
      </div>
    </div>

    <!-- Resource 1 -->
    <div class="resource-content flex-group-center">
      <div class="name-input">
        <input type="text" name="system.resources.rp1.name" value="{{system.resources.rp1.name}}" data-dtype="String" placeholder="Resource 1" class="resource-label" />
      </div>
      <div class="buttons-inc">
        <button class="increment-button" data-resource="rp1" data-action="decrease"><i class="fas fa-minus"></i></button>
        <input type="text" name="system.resources.rp1.value" data-tooltip="Current: {{system.resources.rp1.value}}<br>Step: X<br>Max: X<br>" aria-describedby="tooltip" value="{{system.resources.rp1.value}}" data-dtype="Number" id="rp1-input" class="resource-input" />
        <button class="increment-button" data-resource="rp1" data-action="increase"><i class="fas fa-plus"></i></button>
      </div>
    </div>

    <!-- Resource 2 -->
    <div class="resource-content  flex-group-center">
      <div class="name-input">
        <input type="text" name="system.resources.rp2.name" value="{{system.resources.rp2.name}}" data-dtype="String" placeholder="Resource 2" class="resource-label" />
      </div>
      <div class="buttons-inc">
        <button class="increment-button" data-resource="rp2" data-action="decrease"><i class="fas fa-minus"></i></button>
        <input type="text" name="system.resources.rp2.value" data-tooltip="Current: {{system.resources.rp2.value}}<br>Step: X<br>Max: X<br>" aria-describedby="tooltip" value="{{system.resources.rp2.value}}" data-dtype="Number" id="rp2-input" class="resource-input" />
        <button class="increment-button" data-resource="rp2" data-action="increase"><i class="fas fa-plus"></i></button>
      </div>
    </div>
    
    <!-- Resource 3 -->
    <div class="resource-content  flex-group-center">
      <div class="name-input">
        <input type="text" name="system.resources.rp3.name" value="{{system.resources.rp3.name}}" data-dtype="String" placeholder="Resource 3" class="resource-label" />
      </div>
      <div class="buttons-inc">
        <button class="increment-button" data-resource="rp3" data-action="decrease"><i class="fas fa-minus"></i></button>
        <input type="text" name="system.resources.rp3.value" data-tooltip="Current: {{system.resources.rp3.value}}<br>Step: X<br>Max: X<br>" aria-describedby="tooltip" value="{{system.resources.rp3.value}}" data-dtype="Number" id="rp3-input" class="resource-input" />
        <button class="increment-button" data-resource="rp3" data-action="increase"><i class="fas fa-plus"></i></button>
      </div>
    </div>

    <!-- Roll Check -->
    <div class="resource flex-group-center">
      <span class="rollable rollcheck" data-type="rollcheck" data-roll-type="rollcheck" data-roll="1d@attributes.dex.current + 1d@attributes.ins.current + @derived.init.value">
        <label for="system.derived.init.value" class="resource-label">
          <span class="rollable resource-label">
            <i class="fa-solid fa-dice icon"></i>{{localize 'FU.RollCheck'}}
          </span>
        </label>
      </span>
      <div class="resource-content flexrow flex-center flex-between buttons-inc">
        <div class="">
          <select value="{{system.rollInfo.attributes.primary.value}}" name="system.rollInfo.attributes.primary.value" class="resource-input">
            {{#select system.rollInfo.attributes.primary.value}}
            <option value="attributes.dex.current">{{localize 'FU.AttributeDexAbbr'}}</option>
            <option value="attributes.ins.current">{{localize 'FU.AttributeInsAbbr'}}</option>
            <option value="attributes.mig.current">{{localize 'FU.AttributeMigAbbr'}}</option>
            <option value="attributes.wlp.current">{{localize 'FU.AttributeWlpAbbr'}}</option>
            {{/select}}
          </select>
        </div>
        <span class="roll-check-option" data-tooltip="Customize Roll" aria-describedby="tooltip"><i class="fas fa-plus"></i></span>
        <div class="">
          <select value="{{system.rollInfo.attributes.secondary.value}}" name="system.rollInfo.attributes.secondary.value" class="resource-input">
            {{#select system.rollInfo.attributes.secondary.value}}
            <option value="attributes.dex.current">{{localize 'FU.AttributeDexAbbr'}}</option>
            <option value="attributes.ins.current">{{localize 'FU.AttributeInsAbbr'}}</option>
            <option value="attributes.mig.current">{{localize 'FU.AttributeMigAbbr'}}</option>
            <option value="attributes.wlp.current">{{localize 'FU.AttributeWlpAbbr'}}</option>
            {{/select}}
          </select>
        </div>
      </div>
    </div>
  </div>
  {{!-- End Extra Section --}}

  {{!-- Start Affinity Section --}}
  <div class="grid grid-9col">
    {{#affinity system.affinity}}
      <div class="flex-group-center resource-content">
        <label>
          <span class="resource-label">
            <i class="{{icon}} icon-aff"></i>
            <br>{{localize label}}
          </span>
        </label>
        <select value="{{value}}" name="{{name}}" class="resource-input select-dropdown">
          {{#select value}}
            <option value="NA">-</option>
            <option value="VU">VU</option>
            <option value="RS">RS</option>
            <option value="IM">IM</option>
            <option value="AB">AB</option>
          {{/select}}
        </select>
      </div>
    {{/affinity}}
  </div>
  {{!-- End Affinity Section --}}

  {{!-- Start Sheet Tab Navigation --}}
  <nav class="sheet-tabs tabs" data-group="primary">
    {{!-- Default tab is specified in actor-sheet.mjs --}}
    <a class="item rollable tab-style" data-tab="features">{{localize 'FU.Stats'}}</a>
    <a class="item rollable tab-style" data-tab="skills">{{localize 'FU.Classes'}}</a>
    <a class="item rollable tab-style" data-tab="items">{{localize 'FU.Items'}}</a>
    <a class="item rollable tab-style" data-tab="spells">{{localize 'FU.Spells'}}</a>
    <a class="item rollable tab-style" data-tab="crafts">{{localize 'FU.Crafts'}}</a>
    <a class="item tab-style" data-tab="effects" data-tooltip="{{localize 'FU.Effects'}}" aria-describedby="tooltip"><i class="fa-solid fa-wand-magic-sparkles"></i></a>
    <a class="item tab-style" data-tab="settings" data-tooltip="{{localize 'FU.Settings'}}" aria-describedby="tooltip"><i class="fa-solid fa-bars"></i></a>
  </nav>
  {{!-- End Sheet Tab Navigation --}}

  {{!-- Sheet Body --}}
  <section class="sheet-body">
    {{!-- Owned Features Tab --}}
    <div class="tab features" data-group="primary" data-tab="features">
      <section class="grid grid-3col">
        <aside class="sidebar flex-group-center">
          {{!-- The grid classes are defined in scss/global/_grid.scss. To use,
          use both the "grid" and "grid-Ncol" class where "N" can be any number
          from 1 to 12 and will create that number of columns. --}}
          <div class="abilities flexcol">
            {{#each system.attributes as |attribute key|}}
              <div class="ability resource-content flexrow flex-group-center">
                <label for="system.attributes.{{key}}.base" class="resource-label flexlarge align-left" data-label="{{attribute.label}}">
                  <span class="resource-label">{{attribute.label}}</span>
                </label>
                <select class="resource-input" data-dtype="Number" value="{{attribute.base}}" name="system.attributes.{{key}}.base" >
                  {{#select attribute.base}}
                    <option value="6">d6</option>
                    <option value="8">d8</option>
                    <option value="10">d10</option>
                    <option value="12">d12</option>
                  {{/select}}
                </select>
                <span class="ability-mod">
                  <span class="resource-label">{{ attribute.current }}</span>
                </span>
              </div>
            {{/each}}
          </div>
        </aside>
        
        <!-- Favorite Section -->
        <section class="grid-start-2 grid-span-2 align-right">
          <ol class="items-list">
            <li class="item flexrow items-header">
              <div class="item-name">{{localize 'FU.Name'}}</div>
              <div class="item-equipped">{{localize 'FU.FavoriteStatus'}}</div>
              <div class="item-controls">
                <a
                  class="item-control"
                  data-tooltip="{{localize 'FU.isFavored'}}"
                  data-type="weapon"
                  ><i class="fa-solid fa-sort"></i>{{localize 'FU.Sort'}}</a
                >
              </div>
            </li>
            {{#each items as |item id|}}
              {{#if (and item.system.isFavored.value)}}
                  <li class="item" data-item-id="{{item._id}}">
                    <div class="flexrow">
                      <div class="item-name click-item individual-trapping-and-description">
                        <div class="item-image">
                          <a class="rollable" data-roll-type="item">
                            <div class="item-image-wrap">
                              <img src="{{item.img}}" data-tooltip="{{item.name}}" class="item-image-res" />
                            </div>
                          </a>
                        </div>
                        <h4>
                          {{item.name}} {{#if item.isMartial.value}}
                          <span class="is-martial">✦</span>
                          {{/if}}
                        </h4>
                      </div>
                      <div class="item-equipped">
  
                      </div>
                      <div class="item-controls">
                        <a
                        class="item-control item-favored"
                        {{#if item.system.isFavored.value}}
                        data-tooltip="{{localize 'FU.Unfavorite'}}"
                        {{else}}
                        data-tooltip="{{localize 'FU.Favorite'}}"
                        {{/if}}
                      >
                        {{#if item.system.isFavored.value}}
                        <i class="fa-solid fa-star"></i>
                        {{else}}
                        <i class="fa-regular fa-star"></i>
                        {{/if}}
                      </a>
                        <a class="item-control item-edit" data-tooltip="{{localize 'FU.WeaponEdit'}}"
                          ><i class="fas fa-edit"></i
                        ></a>
                      </div>
                    </div>
                    <div class="individual-description">{{ item.quality.value }}</div>
                  </li>
                {{/if}}
            {{/each}}
          </ol>
        </section>
      
      <!-- Start Trait Border Label here-->
      </section>
      <div class="breakline-border">
        <div class="center-label">
          <label class="resource-label">
            <span class="resource-label">
              <i class="fa-solid fa-diamond rollable icon"></i>{{localize 'FU.Traits'}}
            </span>
          </label>
        </div>
      </div>

      {{!-- Traits Section --}}
      <section class="grid-start-3">
        <div class="flex-group-center">
          <label class="align-left">
            <span class="resource-label">{{localize 'FU.Identity'}}</span>
          </label>
          <input type="text" name="system.resources.identity.name" value="{{system.resources.identity.name}}" data-dtype="String" class="resource-input-traits" />
          <label class="align-left">
            <span class="resource-label">{{localize 'FU.Theme'}}</span>
          </label>
          <input type="text" name="system.resources.theme.name" value="{{system.resources.theme.name}}" data-dtype="String" class="resource-input-traits" />
          <label class="align-left">
            <span class="resource-label">{{localize 'FU.Origin'}}</span>
          </label>
          <input type="text" name="system.resources.origin.name" value="{{system.resources.origin.name}}" data-dtype="String" class="resource-input-traits" />
        </div>

        <!-- Start Bonds Border Label here-->
        <div class="breakline-border">
          <div class="center-label">
            <label for="system.resources.bond.name" class="resource-label">
              <span class="resource-label">
                <i class="fa-solid fa-link icon rollable"></i>{{localize 'FU.Bonds'}}
              </span>
            </label>
          </div>
        </div>

      {{!-- Bond Section --}}
      <section class="grid-start-4">
        <div class="resource-content grid grid-5col flexrow flex-between">
          {{!-- New Bonds Here--}}
          {{> "systems/fabulaultima/templates/actor/parts/actor-bonds.html" groups=systemData.bond dtypes=dtypes}}
        </div>

        {{!-- Add New Bonds Here--}}
        <div class="buttons-inc flex-group-center">
          <a class="buttons-container-inc" data-tooltip="Add Bond" data-type="bond">
            <button class="increment-button" style="visibility: visible;" data-resource="" data-tooltip="{{localize 'FU.Add'}}" data-action=""><i class="fas fa-plus"></i></button>
          </a>
        </div>
      </section>
    </section>
    <!-- End Bonds here-->

      <div class="breakline-border">
        <div class="center-label">
          <label for="system.resources.bond.name" class="resource-label">
            <span class="resource-label">
              {{!-- Insert new section labels here --}}
            </span>
          </label>
        </div>
      </div>
    </div>

    <!-- Handlebar partial template inclusion-->

    {{!-- Skills Tab --}}
    <div class="tab skills" data-group="primary" data-tab="skills">
      {{> "systems/fabulaultima/templates/actor/parts/actor-features.html"}}
    </div>
    {{!-- Owned Items Tab --}}
    <div class="tab items" data-group="primary" data-tab="items">
      {{> "systems/fabulaultima/templates/actor/parts/actor-items.html"}}
    </div>
    {{!-- Owned Spells Tab --}}
    <div class="tab spells" data-group="primary" data-tab="spells">
      {{> "systems/fabulaultima/templates/actor/parts/actor-spells.html"}}
    </div>
    {{!-- Owned Crafts Tab --}}
    <div class="tab crafts" data-group="primary" data-tab="crafts">
      {{> "systems/fabulaultima/templates/actor/parts/actor-crafts.html"}}
    </div>
    {{!-- Active Effects Tab --}}
    <div class="tab effects flexcol" data-group="primary" data-tab="effects">
      {{> "systems/fabulaultima/templates/actor/parts/actor-effects.html"}}
    </div>
    {{!-- Settings Tab --}}
    <div class="tab effects flexcol" data-group="primary" data-tab="settings">
      {{> "systems/fabulaultima/templates/actor/parts/actor-settings.html"}}
    </div>
  </section>
</form>